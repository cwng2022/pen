# Pen - 螢幕標註工具 PRD

## 產品概述

Pen 是一款 macOS 螢幕標註工具，靈感來自 Windows PowerToys 的螢幕畫筆功能。用戶可以通過快捷鍵快速啟動，在螢幕上任意繪製、標註，適用於演示、教學、截圖標註等場景。

## 目標用戶

- 需要在演示時標註螢幕的講師/演講者
- 錄製教學影片的創作者
- 需要快速截圖標註的專業人士

## 核心功能

### 1. 全局快捷鍵啟動

| 快捷鍵 | 功能 |
|--------|------|
| `⌘ + 2` | 啟動/關閉標註模式 |

啟動後：
- 建立一個全螢幕透明覆蓋層
- 游標變為畫筆圖示
- 預設進入畫筆模式

### 2. 繪圖工具

#### 2.1 畫筆工具（預設）
- 自由繪製曲線
- 滑鼠/觸控板按下拖動即可繪製

#### 2.2 形狀工具
- **觸發方式**：按住 `⌘` 鍵 + 拖動
- **預設形狀**：正方形
- **切換形狀**：
  | 快捷鍵 | 形狀 |
  |--------|------|
  | `1` | 正方形 |
  | `2` | 圓形 |
  | `3` | 箭頭 |
- **行為**：以滑鼠按下點為起點，拖動繪製形狀
- **釋放 `⌘`**：返回畫筆模式

#### 2.3 橡皮擦工具
- **觸發方式**：`E` 鍵切換
- **行為**：擦除經過的筆劃
- **大小**：跟隨當前筆劃大小設定
- **退出**：再按 `E` 或切換其他工具

#### 2.4 文字工具
- **觸發方式**：`⌘ + T`
- **行為**：點擊螢幕任意位置，彈出文字輸入框
- **確認**：按 Enter 或點擊其他位置完成輸入
- **取消**：按 Esc 取消輸入

### 3. 顏色切換

| 快捷鍵 | 顏色 |
|--------|------|
| `R` | 紅色 (#FF3B30) |
| `G` | 綠色 (#34C759) |
| `B` | 藍色 (#007AFF) |
| `Y` | 黃色 (#FFCC00) |

- 切換後立即生效，新繪製內容使用新顏色
- 已繪製內容不受影響

### 4. 大小調整

| 快捷鍵 | 功能 |
|--------|------|
| `⌘ + +` | 增加筆劃/線條/字體大小 |
| `⌘ + -` | 減少筆劃/線條/字體大小 |

- 大小範圍：1pt - 50pt
- 預設大小：5pt
- 每次調整步進：2pt

### 5. 截圖功能

| 快捷鍵 | 功能 |
|--------|------|
| `⌘ + 6` | 截取當前螢幕（包含標註內容） |

- 截圖保存至桌面，檔名格式：`Pen_Screenshot_YYYYMMDD_HHmmss.png`
- 截圖時顯示短暫的閃爍動畫反饋

### 6. 其他操作

| 快捷鍵 | 功能 |
|--------|------|
| `⌘ + Z` | 撤銷上一步操作 |
| `⌘ + ⇧ + Z` | 重做 |
| `C` | 清除所有標註 |
| `Esc` | 退出標註模式 |

### 7. 多螢幕支援

- 啟動時在**所有連接的螢幕**上建立透明覆蓋層
- 畫筆可跨螢幕連續繪製
- 截圖時可選擇：
  - 截取單一螢幕（當前游標所在）
  - 截取所有螢幕（拼接為一張圖）

### 8. 保存/載入標註

| 快捷鍵 | 功能 |
|--------|------|
| `⌘ + S` | 保存當前標註 |
| `⌘ + O` | 載入已保存標註 |

- 保存格式：`.pen` 檔案（JSON 格式）
- 保存內容：所有筆劃、形狀、文字的座標、顏色、大小
- 預設保存路徑：`~/Documents/Pen/`
- 載入時恢復所有標註到螢幕上

### 9. Menu Bar 圖示

- 在 Menu Bar 顯示畫筆圖示
- 點擊顯示下拉選單：
  - 啟動標註模式
  - 最近保存的標註（快速載入）
  - 偏好設定
  - 關於 Pen
  - 退出

## 技術架構

```
pen/
├── penApp.swift                  # App 入口
├── Views/
│   ├── OverlayWindow.swift       # 全螢幕透明覆蓋視窗
│   ├── CanvasView.swift          # 繪圖畫布
│   ├── TextInputView.swift       # 文字輸入組件
│   ├── MenuBarView.swift         # Menu Bar 下拉選單
│   └── ToolbarView.swift         # 工具列 UI
├── Models/
│   ├── Drawing.swift             # 繪圖數據模型（筆劃、形狀、文字）
│   ├── Tool.swift                # 工具類型枚舉
│   ├── Shape.swift               # 形狀類型枚舉（正方形、圓形、箭頭）
│   ├── AnnotationColor.swift     # 顏色定義
│   └── PenDocument.swift         # .pen 檔案格式定義（Codable）
├── Services/
│   ├── HotkeyManager.swift       # 全局快捷鍵管理
│   ├── ScreenCapture.swift       # 截圖服務
│   ├── DrawingEngine.swift       # 繪圖引擎
│   ├── MultiScreenManager.swift  # 多螢幕管理
│   └── FileManager.swift         # 保存/載入標註檔案
└── Extensions/
    └── CGPoint+Extensions.swift
```

## 技術要點

1. **全局快捷鍵**：使用 `CGEvent.tapCreate` 或第三方庫如 HotKey 監聽全局快捷鍵
2. **透明覆蓋層**：使用 `NSWindow` 設置 `level = .screenSaver`，背景透明
3. **繪圖**：使用 `NSBezierPath` 或 SwiftUI `Canvas` 進行繪製
4. **截圖**：使用 `CGWindowListCreateImage` 進行螢幕截圖
5. **多螢幕**：使用 `NSScreen.screens` 獲取所有螢幕，為每個螢幕建立獨立的 OverlayWindow
6. **Menu Bar**：使用 `NSStatusBar` 建立 Menu Bar 圖示
7. **檔案格式**：使用 `Codable` 序列化繪圖數據為 JSON

## 權限需求

- **輔助功能權限**（Accessibility）：監聽全局快捷鍵
- **螢幕錄製權限**（Screen Recording）：截圖功能

## UI/UX 設計

### 啟動時
- 在螢幕右下角顯示小型工具列（可選）
- 顯示當前工具、顏色、大小

### 工具列設計（可選）
```
┌─────────────────────────────────┐
│  🖊️  ⬜  T  │  🔴 🟢 🔵 🟡  │  5pt  │
└─────────────────────────────────┘
```

### 游標樣式
- 畫筆模式：圓點（大小對應筆劃粗細）
- 形狀模式：十字準星
- 文字模式：I 型游標
- 橡皮擦模式：圓形虛線框（大小對應擦除範圍）

## 開發里程碑

### Phase 1 - 基礎框架
- [ ] 全局快捷鍵 `⌘ + 2` 啟動/關閉
- [ ] 全螢幕透明覆蓋層
- [ ] 基本畫筆繪製
- [ ] Menu Bar 圖示（基本）

### Phase 2 - 完整繪圖功能
- [ ] 形狀繪製（正方形、圓形、箭頭）
- [ ] 文字輸入
- [ ] 橡皮擦工具
- [ ] 顏色切換 (R/G/B/Y)
- [ ] 大小調整

### Phase 3 - 進階功能
- [ ] 撤銷/重做
- [ ] 截圖功能
- [ ] 清除所有標註
- [ ] 多螢幕支援

### Phase 4 - 持久化與 UI
- [ ] 保存/載入標註（.pen 格式）
- [ ] 工具列 UI
- [ ] Menu Bar 完整選單
- [ ] 游標樣式
- [ ] 偏好設定面板

## 已確認功能

- ✅ 多螢幕支援
- ✅ 保存/載入標註
- ✅ 更多形狀（圓形、箭頭）
- ✅ 橡皮擦工具
- ✅ Menu Bar 圖示
